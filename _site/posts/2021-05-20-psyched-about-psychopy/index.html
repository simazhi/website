<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Thomas Van Hoey">
<meta name="dcterms.date" content="2021-05-20">

<title>Psyched about PsychoPy – Thomas Van Hoey</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Thomas Van Hoey</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-researching" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Researching</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-researching">    
        <li>
    <a class="dropdown-item" href="../../STILL NEED TO ADD">
 <span class="dropdown-text">Borrowing iconic words (2024-2027)</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../STILL NEED TO ADD">
 <span class="dropdown-text">Grammatical alternation and relative complexity (2023-2024)</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../STILL NEED TO ADD">
 <span class="dropdown-text">Transmitting ideophones (2021-2022)</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../STILL NEED TO ADD">
 <span class="dropdown-text">Chinese Ideophone Database (2017-2020)</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../STILL NEED TO ADD">
 <span class="dropdown-text">Prototypicality of ideophones (2015-2020)</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="../../STILL NEED TO ADD"> 
<span class="menu-text">Teaching</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../STILL NEED TO ADD"> 
<span class="menu-text">Supervising</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../STILL NEED TO ADD"> 
<span class="menu-text">Reviewing</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../blog.html"> 
<span class="menu-text">Blogging</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../archive.html"> 
<span class="menu-text">Archiving</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../STILL NEED TO ADD"> 
<span class="menu-text">short CV</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://www.thomasvanhoey.com/cv/cv_thomas.pdf"> 
<span class="menu-text">full CV</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="../../blog.xml"> <i class="bi bi-rss" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Psyched about PsychoPy</h1>
                                <div class="quarto-categories">
                <div class="quarto-category">HKU</div>
                <div class="quarto-category">psychopy</div>
                <div class="quarto-category">experiments</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Thomas Van Hoey </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">May 20, 2021</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#wtf-is-psychopy" id="toc-wtf-is-psychopy" class="nav-link active" data-scroll-target="#wtf-is-psychopy">WTF is PsychoPy</a></li>
  <li><a href="#builder" id="toc-builder" class="nav-link" data-scroll-target="#builder">Builder</a></li>
  <li><a href="#deploying-and-running-on-pavlovia" id="toc-deploying-and-running-on-pavlovia" class="nav-link" data-scroll-target="#deploying-and-running-on-pavlovia">Deploying and running on Pavlovia</a></li>
  <li><a href="#community" id="toc-community" class="nav-link" data-scroll-target="#community">Community</a></li>
  <li><a href="#not-very-obvious-aspects" id="toc-not-very-obvious-aspects" class="nav-link" data-scroll-target="#not-very-obvious-aspects">Not very obvious aspects</a>
  <ul class="collapse">
  <li><a href="#which-kind-stimulus-must-i-use" id="toc-which-kind-stimulus-must-i-use" class="nav-link" data-scroll-target="#which-kind-stimulus-must-i-use">1. Which kind stimulus must I use</a></li>
  <li><a href="#textobject-is-not-text" id="toc-textobject-is-not-text" class="nav-link" data-scroll-target="#textobject-is-not-text">2. TextObject is not Text</a></li>
  <li><a href="#exporting-to-html" id="toc-exporting-to-html" class="nav-link" data-scroll-target="#exporting-to-html">3. Exporting to HTML</a></li>
  <li><a href="#some-code-functions-dont-work-on-pavlovia" id="toc-some-code-functions-dont-work-on-pavlovia" class="nav-link" data-scroll-target="#some-code-functions-dont-work-on-pavlovia">4. Some code functions don’t work on Pavlovia</a></li>
  <li><a href="#general-documentation-is-not-builder-focused" id="toc-general-documentation-is-not-builder-focused" class="nav-link" data-scroll-target="#general-documentation-is-not-builder-focused">5. General documentation is not builder focused</a></li>
  <li><a href="#randomization" id="toc-randomization" class="nav-link" data-scroll-target="#randomization">6. Randomization</a></li>
  </ul></li>
  <li><a href="#other-handy-resources" id="toc-other-handy-resources" class="nav-link" data-scroll-target="#other-handy-resources">Other handy resources</a></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion">Conclusion</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<p><img src="featured.png" class="img-fluid"></p>
<p>A few weeks ago I <em>twote</em> this:</p>
<blockquote class="twitter-tweet blockquote">
<p lang="en" dir="ltr">
Won't say I'm a pro (more like intermediate if even that much ha) but can now say that I am sufficiently familiar enough with <a href="https://twitter.com/psychopy?ref_src=twsrc%5Etfw"><span class="citation" data-cites="psychopy">@psychopy</span></a> to build experiments for research on ideophones and iconicity. <br><br>But the learning route has been pretty 𝑘𝑎̌𝑛𝑘𝑒̌ 坎坷.
</p>
— Thomas Van Hoey | 𓏏𓅓𓋴 | 司馬智 (<span class="citation" data-cites="Simazhi">@Simazhi</span>) <a href="https://twitter.com/Simazhi/status/1388039322192945152?ref_src=twsrc%5Etfw">April 30, 2021</a>
</blockquote>
<script async="" src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
<p>Because <a href="https://sites.google.com/view/bonniemclean/home">Bonnie McLean</a> asked for a blog about the experience and some general thoughts on the use of <a href="https://www.psychopy.org/">PsychoPy</a>, I decided to write it down. So here it is.</p>
<section id="wtf-is-psychopy" class="level1">
<h1>WTF is PsychoPy</h1>
<p>PsychoPy (Peirce et al.&nbsp;2019 <a href="https://link.springer.com/content/pdf/10.3758/s13428-018-01193-y.pdf">doi: 10.3758/s13428-018-01193-y</a>) is an application for the creation of experiments in behavioral science (psychology, neuroscience, linguistics, etc.) with precise spatial control and timing of stimuli. There are two ways of creating an experiment: either by writing raw python code, or by using the Builder to get a more GUI experience (to which some code can be appended).</p>
<p>For someone with a more corpus-oriented background (<em>le moi</em>), it was looking like a daunting task to create this kind of experiments for which it was important that the reaction times etc. were controlled for. Note that other software like Qualtrics, or even Google Forms, is still great for surveys for which such control is not super relevant; but it makes sense to think that in psycholinguistics we ideally would want to capture such information in a realiable manner. There’s also a budding psycholinguistic community that is based on the Shiny framework for R, like <a href="https://ndphillips.github.io/ShinyPsych.html">ShinyPsych</a>, and I know the aforementioned Bonnie is also scripting experiments based on R, although I don’t know if its ShinyPsych.</p>
<p>So, because PsychoPy is supposedly easy to use, open source, and because it can also be deployed on its linked platform Pavlovia to actually run the experiments, it seemed like a good choice to base our experimental work on, especially in times of Covid. However, for the preparation of stimuli and the post-hoc analysis, I still turn to R.</p>
</section>
<section id="builder" class="level1">
<h1>Builder</h1>
<p>This is what a general PsychoPy experiment in the Builder view looks like.</p>
<p><img src="https://media.springernature.com/full/springer-static/image/art%3A10.3758%2Fs13428-018-01193-y/MediaObjects/13428_2018_1193_Fig1_HTML.png?as=webp" class="img-fluid"></p>
<p>In the lower box, you can see the different “<em>routines</em>” that make up the experiment. For instance, here you have the instructions ‘instructPractice’, followed by the ‘trial’ and ‘feedback’, which are repeated in a loop. Then you have some new instructions ‘instruct’, followed by the “real experiment” ‘trial’ and a loop again. Finally, a few words of thanks for participating.</p>
<p>In the upper box, you have the <strong>uniquely named</strong> components of a routine, in this case ‘trial’. You can see that there is a fixation cross present. At some point, a word stimulus will appear. People will have to press a key to respond and then the experiment will go to the next trial in the loop.</p>
<p>So the general buildup is pretty explanatory, and you find heaps of videos on youtube that show the basic anatomy. On of my favorites is the following, on creating a word based reaction time study (watch at your own pace, or as the Japanese say <em>mai peesu de</em> マイペースで):</p>
<iframe width="560" height="315" src="https://www.youtube.com/embed/cQ6Bhj7OILk" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen="">
</iframe>
<p>Following along with such instructional videos can get you up and running pretty fast, although it felt like a struggle because I had to start from scratch. Below I’ll list some things that were not super obvious to me in the beginning. But first, deploying the experiment online.</p>
</section>
<section id="deploying-and-running-on-pavlovia" class="level1">
<h1>Deploying and running on Pavlovia</h1>
<p>One of the selling points of PsychoPy is the supposed seamless integration with a platform called <a href="https://pavlovia.org/">Pavlovia</a>. You can upload your experiment to this platform, pilot the experiment and finally run it. You do have to pay for running it, but the credits are not very expensive, and you only have to pay for the experiments that are completed; so not for participants that somewhere along the way leave.</p>
<p>Since it was not super intuitive of how to actually deploy the experiment, I once again turned to youtube. Luckily, there were some good demo videos for this aspect as well. My favorite, which helped me the most, is this series by a certain Jordan Gallant:</p>
<ul>
<li><a href="https://youtu.be/UULoyXVLqz4">Intro</a></li>
<li><a href="https://youtu.be/8AcNwLzBwPA">Pavlovia account</a></li>
<li><a href="https://youtu.be/wXcoozHkHHE">Uploading an experiment</a></li>
<li>(<a href="https://youtu.be/OO3nE1m8CpY">Sharing an experiment</a>)</li>
<li>(<a href="https://youtu.be/NtL7hbay-4k">Basic git commands</a>)</li>
</ul>
<p>And now after running the first experiment, I can see say that it works and is accurate enough.</p>
</section>
<section id="community" class="level1">
<h1>Community</h1>
<p>Another aspect that I haven’t touched on yet, is the community. Most people familiar with R or python or what have you know that this aspect is actually quite important. From my mentioning of youtube you can already gauge that there is some vibrancy concerning PsychoPy, but it’s not until you head to <a href="https://discourse.psychopy.org/">https://discourse.psychopy.org/</a> that you can really find out how thriving it actually is. People will ask questions about errors they face, much like stack overflow, and some of the issues I encountered were indeed answered there (yet not all, spoiler). But so this makes for another compelling reason of why PsychoPy may be a good vehicle for your experiments.</p>
</section>
<section id="not-very-obvious-aspects" class="level1">
<h1>Not very obvious aspects</h1>
<p>Here is a series of issues I faced thus far.</p>
<section id="which-kind-stimulus-must-i-use" class="level2">
<h2 class="anchored" data-anchor-id="which-kind-stimulus-must-i-use">1. Which kind stimulus must I use</h2>
<p>Perhaps it is because of my background, but it is not always very clear what component of the builder I have to use to get what I want. For instance, figuring out the button or radio boxes is quite hard, and I eventually found other ways of doing it, because I couldn’t figure it out.</p>
</section>
<section id="textobject-is-not-text" class="level2">
<h2 class="anchored" data-anchor-id="textobject-is-not-text">2. TextObject is not Text</h2>
<p>In the builder you can find two components that seem pretty similar, TextObject and Text. However, they are not the same: TextObject has many more variables you can set, like having a border around your text object (which is pretty crucial in my opinion). While TextObject, at the time of writing, has a small ‘beta’ sticker on top of it, it appeared to me as the new and improved text stimulus go-to. One of the main benefits of TextObject is that the text can be editable, i.e., they can act as small forms. (I don’t know what they did before this function, since that seems pretty crucial??)</p>
<p>But, as the image shows, using TextObject for non-editable text can lead to some weird situation. So better to use a Text component for that.</p>
<p><img src="images/Schermafbeelding 2021-04-20 om 15.00.44.png" class="img-fluid"></p>
</section>
<section id="exporting-to-html" class="level2">
<h2 class="anchored" data-anchor-id="exporting-to-html">3. Exporting to HTML</h2>
<p>In order to save space or something the default pipeline no longer creates and updates an HTML folder within your PsychoPy folder. However, things would not work for me like that (as opposed to what the forums say), so I had to change my preferences. However, they are not in the preferences, but under the wheel icon.</p>
<p><img src="images/CleanShot 2021-05-20 at 11.55.14@2x.png" class="img-fluid"></p>
<p>Then change the path.</p>
<p><img src="images/CleanShot 2021-05-20 at 11.56.24@2x.png" class="img-fluid"></p>
<p>Now it will work.</p>
</section>
<section id="some-code-functions-dont-work-on-pavlovia" class="level2">
<h2 class="anchored" data-anchor-id="some-code-functions-dont-work-on-pavlovia">4. Some code functions don’t work on Pavlovia</h2>
<p>Once I was finally happy that I had gotten my experiment up and running offline, I was ready to move online. However, some of the handy code components that I had introduced (by following other people’s, as all coders do), didn’t work on Pavlovia. For instance, the quitting function <code>core.quit()</code> does not work; instead you need to replace it with PsychoJS (yes PsychoPy’s own JavaScript implementation) code, like <code>psychoJS.quit()</code>.</p>
</section>
<section id="general-documentation-is-not-builder-focused" class="level2">
<h2 class="anchored" data-anchor-id="general-documentation-is-not-builder-focused">5. General documentation is not builder focused</h2>
<p>I wish the documentation on the website was a bit more visual rather than code-based; as they are promoting this as a “you can build it” kind of software, it was a bit of a hurdle to get over all the technical description of component settings. But it’s not a hurdle that’s too high.</p>
<iframe src="https://giphy.com/embed/UxNTT095uL0go" width="480" height="270" frameborder="0" class="giphy-embed" allowfullscreen="">
</iframe>
<p>
<a href="https://giphy.com/gifs/bob-the-builder-yes-we-can-UxNTT095uL0go">via GIPHY</a>
</p>
</section>
<section id="randomization" class="level2">
<h2 class="anchored" data-anchor-id="randomization">6. Randomization</h2>
<p>There are still aspects of randomization I can’t figure out, mostly involving counterbalancing. Perhaps in due time I will find a way to do it.</p>
</section>
</section>
<section id="other-handy-resources" class="level1">
<h1>Other handy resources</h1>
<p>Luckily the community is quite good, so there are some documents that help you set up the experiment and “translate” it to Pavlovia.</p>
<p>Two must-reads are:</p>
<ul>
<li><a href="https://docs.google.com/document/d/13jp0QAqQeFlYSjeZS0fDInvgaDzBXjGQNe4VNKbbNHQ/edit?usp=sharing">the 2020 cribsheet</a></li>
<li><a href="https://docs.google.com/document/d/183xmwDgSbnJZHMGf3yWpieV9Bx8y7fOCm3QKkMOOXFQ/edit?usp=sharing">the updated 2021 cribsheet</a></li>
</ul>
</section>
<section id="conclusion" class="level1">
<h1>Conclusion</h1>
<p>So all in all I’m quite happy we are using PsychoPy. Having become familiar with the basic functions has enabled me to set up experiments, in such a way that analysis afterwards is clear and reproducible. There is a learning curve, but there is also a supportive community to help out.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/thomasvanhoey\.com");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>